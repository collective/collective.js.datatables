/*
 * File:        FixedColumns.min.js
 * Version:     2.0.0
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * 
 * Copyright 2010-2010 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license, available at:
 *   http://datatables.net/license_gpl2
 *   http://datatables.net/license_bsd
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
/*
     GPL v2 or BSD 3 point style
*/
var FixedColumns;
(function(c,m){FixedColumns=function(a,d){if(!this instanceof FixedColumns)alert("FixedColumns warning: FixedColumns must be initialised with the 'new' keyword.");else{if(typeof d=="undefined")d={};this.s={dt:a.fnSettings(),iTableColumns:a.fnSettings().aoColumns.length,aiWidths:[],bOldIE:c.browser.msie&&(c.browser.version=="6.0"||c.browser.version=="7.0")};this.dom={scroller:null,header:null,body:null,footer:null,grid:{wrapper:null,dt:null,left:{wrapper:null,head:null,body:null,foot:null},right:{wrapper:null,
head:null,body:null,foot:null}},clone:{left:{header:null,body:null,footer:null},right:{header:null,body:null,footer:null}}};this._fnConstruct(d)}};FixedColumns.prototype={fnUpdate:function(){this._fnDraw(true)},fnRecalculateHeight:function(a){a._DTTC_iHeight=null;a.style.height="auto"},fnSetRowHeight:function(a,d){var b=c(a).children(":first");b=b.outerHeight()-b.height();if(c.browser.mozilla||c.browser.opera)a.style.height=d+"px";else c(a).children().height(d-b)},_fnConstruct:function(a){var d,b=
this;if(typeof this.s.dt.oInstance.fnVersionCheck!="function"||this.s.dt.oInstance.fnVersionCheck("1.7.6")!==true)alert("FixedColumns 2 required DataTables 1.7.6 or later. Please upgrade your DataTables installation");else if(this.s.dt.oScroll.sX==="")this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"FixedColumns is not needed (no x-scrolling in DataTables enabled), so no action will be taken. Use 'FixedHeader' for column fixing when scrolling is not enabled");else{this.s=c.extend(true,this.s,FixedColumns.defaults,
a);this.dom.grid.dt=c(this.s.dt.nTable).parents("div.dataTables_scroll")[0];this.dom.scroller=c("div.dataTables_scrollBody",this.dom.grid.dt)[0];a=c(this.dom.grid.dt).width();var f=0,e=0;c("tbody>tr:eq(0)>td",this.s.dt.nTable).each(function(i){d=c(this).outerWidth();b.s.aiWidths.push(d);if(i<b.s.iLeftColumns)f+=d;if(b.s.iTableColumns-b.s.iRightColumns<=i)e+=d});if(this.s.iLeftWidth===null)this.s.iLeftWidth=this.s.sLeftWidth=="fixed"?f:f/a*100;if(this.s.iRightWidth===null)this.s.iRightWidth=this.s.sRightWidth==
"fixed"?e:e/a*100;this._fnGridSetup();for(a=0;a<this.s.iLeftColumns;a++)this.s.dt.oInstance.fnSetColumnVis(a,false);for(a=this.s.iTableColumns-this.s.iRightColumns;a<this.s.iTableColumns;a++)this.s.dt.oInstance.fnSetColumnVis(a,false);c(this.dom.scroller).scroll(function(){b.dom.grid.left.body.scrollTop=b.dom.scroller.scrollTop;if(b.s.iRightColumns>0)b.dom.grid.right.body.scrollTop=b.dom.scroller.scrollTop});c(m).resize(function(){b._fnGridLayout.call(b)});var g=true;this.s.dt.aoDrawCallback=[{fn:function(){b._fnDraw.call(b,
g);b._fnGridHeight(b);g=false},sName:"FixedColumns"}].concat(this.s.dt.aoDrawCallback);this._fnGridLayout();this._fnGridHeight();this.s.dt.oInstance.fnDraw(false)}},_fnGridSetup:function(){this.dom.body=this.s.dt.nTable;this.dom.header=this.s.dt.nTHead.parentNode;this.dom.header.parentNode.parentNode.style.position="relative";var a=c('<div class="DTFC_ScrollWrapper" style="position:relative; clear:both;"><div class="DTFC_LeftWrapper" style="position:absolute; top:0; left:0;"><div class="DTFC_LeftHeadWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_LeftBodyWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_LeftFootWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div></div><div class="DTFC_RightWrapper" style="position:absolute; top:0; left:0;"><div class="DTFC_RightHeadWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_RightBodyWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div><div class="DTFC_RightFootWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div></div></div>')[0];
nLeft=a.childNodes[0];nRight=a.childNodes[1];this.dom.grid.wrapper=a;this.dom.grid.left.wrapper=nLeft;this.dom.grid.left.head=nLeft.childNodes[0];this.dom.grid.left.body=nLeft.childNodes[1];if(this.s.iRightColumns>0){this.dom.grid.right.wrapper=nRight;this.dom.grid.right.head=nRight.childNodes[0];this.dom.grid.right.body=nRight.childNodes[1]}if(this.s.dt.nTFoot){this.dom.footer=this.s.dt.nTFoot.parentNode;this.dom.grid.left.foot=nLeft.childNodes[2];if(this.s.iRightColumns>0)this.dom.grid.right.foot=
nRight.childNodes[2]}a.appendChild(nLeft);this.dom.grid.dt.parentNode.insertBefore(a,this.dom.grid.dt);a.appendChild(this.dom.grid.dt);this.dom.grid.dt.style.position="absolute";this.dom.grid.dt.style.top="0px";this.dom.grid.dt.style.left=this.s.iLeftWidth+"px";this.dom.grid.dt.style.width=c(this.dom.grid.dt).width()-this.s.iLeftWidth-this.s.iRightWidth+"px"},_fnGridLayout:function(){var a=this.dom.grid,d=c(a.wrapper).width(),b=0,f=0,e=0;b=this.s.sLeftWidth=="fixed"?this.s.iLeftWidth:this.s.iLeftWidth/
100*d;f=this.s.sRightWidth=="fixed"?this.s.iRightWidth:this.s.iRightWidth/100*d;e=d-b-f;a.left.wrapper.style.width=b+"px";a.dt.style.width=e+"px";a.dt.style.left=b+"px";if(this.s.iRightColumns>0){a.right.wrapper.style.width=f+"px";a.right.wrapper.style.left=d-f+"px"}},_fnGridHeight:function(){var a=this.dom.grid,d=c(this.dom.grid.dt).height();a.wrapper.style.height=d+"px";a.left.body.style.height=c(this.dom.scroller).height()+"px";a.left.wrapper.style.height=d+"px";if(this.s.iRightColumns>0){a.right.wrapper.style.height=
d+"px";a.right.body.style.height=c(this.dom.scroller).height()+"px"}},_fnDraw:function(a){this._fnCloneLeft(a);this._fnCloneRight(a);this.s.fnDrawCallback!==null&&this.s.fnDrawCallback.call(this,this.dom.clone.left,this.dom.clone.right);c(this).trigger("draw",{leftClone:this.dom.clone.left,rightClone:this.dom.clone.right})},_fnCloneRight:function(a){if(!(this.s.iRightColumns<=0)){var d,b=[];for(d=this.s.iTableColumns-this.s.iRightColumns;d<this.s.iTableColumns;d++)b.push(d);this._fnClone(this.dom.clone.right,
this.dom.grid.right,b,a)}},_fnCloneLeft:function(a){if(!(this.s.iLeftColumns<=0)){var d,b=[];for(d=0;d<this.s.iLeftColumns;d++)b.push(d);this._fnClone(this.dom.clone.left,this.dom.grid.left,b,a)}},_fnClone:function(a,d,b,f){var e=this,g,i,h;if(f){a.header!==null&&a.header.parentNode.removeChild(a.header);a.header=c(this.dom.header).clone(true)[0];a.header.className+=" DTFC_Cloned";a.header.style.width="100%";d.head.appendChild(a.header);c(">thead",a.header).empty();var n=c("thead",a.header)[0];c(">thead>tr",
e.dom.header).each(function(j){var k=this.cloneNode(false);for(h=0;h<b.length;h++){g=b[h];i=j===0?c(e.s.dt.aoColumns[g].nTh).clone(true)[0]:c(e.s.dt.aoColumns[g].anThExtra[j-1]).clone(true)[0];k.appendChild(i)}n.appendChild(k)})}else for(h=0;h<b.length;h++)c(">thead th:eq("+h+")",a.header)[0].className=this.s.dt.aoColumns[b[h]].nTh.className;this._fnEqualiseHeights("thead",this.dom.header,a.header);this.s.sHeightMatch=="auto"&&c(">tbody>tr",e.dom.body).css("height","auto");if(a.body!==null){a.body.parentNode.removeChild(a.body);
a.body=null}a.body=c(this.dom.body).clone(true)[0];a.body.className+=" DTFC_Cloned";a.body.style.paddingBottom=this.s.dt.oScroll.iBarWidth+"px";a.body.style.marginBottom=this.s.dt.oScroll.iBarWidth*2+"px";a.body.getAttribute("id")!==null&&a.body.removeAttribute("id");c(">thead>tr",a.body).empty();c(">tfoot",a.body).empty();var l=c("tbody",a.body)[0];c(l).empty();this.s.dt.aiDisplay.length>0?c(">tbody>tr",e.dom.body).each(function(j){var k=this.cloneNode(false);j=e.s.dt.aiDisplay[e.s.dt._iDisplayStart+
j];for(h=0;h<b.length;h++){g=b[h];if(typeof e.s.dt.aoData[j]._anHidden[g]!="undefined"){i=c(e.s.dt.aoData[j]._anHidden[g]).clone(true)[0];k.appendChild(i)}}l.appendChild(k)}):c(">tbody>tr",e.dom.body).each(function(){i=this.cloneNode(true);i.className+=" DTFC_NoData";c("td",i).html("");l.appendChild(i)});a.body.style.width="100%";d.body.appendChild(a.body);this._fnEqualiseHeights("tbody",e.dom.body,a.body);if(this.s.dt.nTFoot!==null){if(f){a.footer!==null&&a.footer.parentNode.removeChild(a.footer);
a.footer=c(this.dom.footer).clone(true)[0];a.footer.className+=" DTFC_Cloned";a.footer.style.width="100%";d.foot.appendChild(a.footer);c(">tfoot",a.footer).empty();var o=c("tfoot",a.footer)[0];c(">tfoot>tr",e.dom.footer).each(function(j){var k=this.cloneNode(false);for(h=0;h<b.length;h++){g=b[h];i=j===0?c(e.s.dt.aoColumns[g].nTf).clone(true)[0]:c(e.s.dt.aoColumns[g].anTfExtra[j-1]).clone(true)[0];i.style.width=e.s.aiWidths[g]+"px";k.appendChild(i)}o.appendChild(k)})}else for(h=0;h<b.length;h++)c(">tfoot th:eq("+
h+")",a.footer)[0].className=this.s.dt.aoColumns[b[h]].nTf.className;this._fnEqualiseHeights("tfoot",this.dom.footer,a.footer)}d=c(">tbody>tr:eq(0)",a.body);var p=c(">thead>tr:eq(0)",a.header);if(this.s.dt.nTFoot!==null)var q=c(">tfoot>tr:eq(0)",a.footer);d.children().each(function(j){var k=c(this).width();p.children(":eq("+j+")").width(k);e.s.dt.nTFoot!==null&&q.children(":eq("+j+")").width(k)})},_fnGetTrNodes:function(a){for(var d=[],b=0,f=a.childNodes.length;b<f;b++)a.childNodes[b].nodeName.toUpperCase()==
"TR"&&d.push(a.childNodes[b]);return d},_fnEqualiseHeights:function(a,d,b){if(this.s.sHeightMatch!="none"){var f,e,g=d.getElementsByTagName(a)[0];b=b.getElementsByTagName(a)[0];a=c(">"+a+">tr:eq(0)",d).children(":first");a=a.outerHeight()-a.height();g=this._fnGetTrNodes(g);var i=this._fnGetTrNodes(b);b=0;for(d=i.length;b<d;b++)if(this.s.sHeightMatch=="semiauto"&&typeof g[b]._DTTC_iHeight!="undefined"&&g[b]._DTTC_iHeight!==null)!c.browser.mozilla&&!c.browser.opera&&c(i[b]).children().height(g[b]._DTTC_iHeight-
a);else{f=g[b].offsetHeight;e=i[b].offsetHeight;f=e>f?e:f;if(this.s.sHeightMatch=="semiauto")g[b]._DTTC_iHeight=f;if(c.browser.mozilla||c.browser.opera){i[b].style.height=f+"px";g[b].style.height=f+"px"}else{c(i[b]).children().height(f-a);c(g[b]).children().height(f-a)}}}}};FixedColumns.defaults={iLeftColumns:1,iRightColumns:0,fnDrawCallback:null,sLeftWidth:"fixed",iLeftWidth:null,sRightWidth:"fixed",iRightWidth:null,sHeightMatch:"semiauto"};FixedColumns.prototype.CLASS="FixedColumns";FixedColumns.VERSION=
"2.0.0"})(jQuery,window,document);
